Patch for issue 5584